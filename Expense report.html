<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Budget Planner</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-datepicker@4.8.0/dist/react-datepicker.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/react-datepicker@4.8.0/dist/react-datepicker.min.css">
  <style>
    .progress-bar {
      height: 20px;
      background-color: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background-color: #4CAF50;
      transition: width 0.3s ease;
    }
    .scrollable-table {
      max-height: 300px;
      overflow-y: auto;
    }
    .dark-mode {
      background-color: #1a202c;
      color: #f7fafc;
    }
    .dark-mode .card {
      background-color: #2d3748;
      color: #f7fafc;
    }
    .dark-mode input, .dark-mode select, .dark-mode textarea {
      background-color: #4a5568;
      color: #f7fafc;
      border-color: #4a5568;
    }
    .dark-mode .progress-bar {
      background-color: #4a5568;
    }
    @media print {
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { jsPDF } = window.jspdf;

    function App() {
      const [darkMode, setDarkMode] = useState(false);
      const [startDate, setStartDate] = useState(new Date());
      const [endDate, setEndDate] = useState(() => {
        const date = new Date();
        date.setDate(date.getDate() + 30);
        return date;
      });
      const [totalAmount, setTotalAmount] = useState(25000);
      const [categories, setCategories] = useState([
        { id: 1, name: 'Rent', expenses: [] },
        { id: 2, name: 'Groceries', expenses: [] },
        { id: 3, name: 'Transportation', expenses: [] }
      ]);
      const [rules, setRules] = useState([
        { id: 1, type: 'daily', amount: 40, description: 'Daily injections', category: 'Medical' },
        { id: 2, type: 'weekly', day: 0, amount: 300, description: 'Sunday outside food', category: 'Food' }
      ]);
      const [newCategoryName, setNewCategoryName] = useState('');
      const [remainingPlan, setRemainingPlan] = useState({
        amount: 0,
        days: 0
      });
      const [activeTab, setActiveTab] = useState('expenses');
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [newRule, setNewRule] = useState({
        type: 'daily',
        amount: 0,
        description: '',
        category: '',
        day: 0
      });
      const pdfRef = useRef();

      // Calculate derived values
      const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
      const spentAmount = categories.reduce((total, category) => {
        return total + category.expenses.reduce((sum, expense) => sum + expense.amount, 0);
      }, 0);
      const remainingAmount = totalAmount - spentAmount;
      const spentPercentage = (spentAmount / totalAmount) * 100;
      
      // Calculate rule-based expenses
      const calculateRuleExpenses = () => {
        const ruleExpenses = [];
        const currentDate = new Date(startDate);
        
        while (currentDate <= endDate) {
          rules.forEach(rule => {
            if (rule.type === 'daily') {
              ruleExpenses.push({
                date: new Date(currentDate),
                amount: rule.amount,
                description: rule.description,
                category: rule.category,
                fromRule: true
              });
            } else if (rule.type === 'weekly' && currentDate.getDay() === rule.day) {
              ruleExpenses.push({
                date: new Date(currentDate),
                amount: rule.amount,
                description: rule.description,
                category: rule.category,
                fromRule: true
              });
            }
          });
          currentDate.setDate(currentDate.getDate() + 1);
        }
        
        return ruleExpenses;
      };
      
      const ruleExpenses = calculateRuleExpenses();
      const totalRuleAmount = ruleExpenses.reduce((sum, expense) => sum + expense.amount, 0);
      const totalProjectedAmount = spentAmount + totalRuleAmount;
      const projectedRemaining = totalAmount - totalProjectedAmount;
      const projectedPercentage = (totalProjectedAmount / totalAmount) * 100;
      
      // Calculate daily allowance for remaining plan
      const dailyAllowance = remainingPlan.days > 0 ? remainingPlan.amount / remainingPlan.days : 0;
      const weeklyAllowance = remainingPlan.days > 0 ? remainingPlan.amount / (remainingPlan.days / 7) : 0;

      // Load data from localStorage on initial render
      useEffect(() => {
        const savedData = localStorage.getItem('budgetPlannerData');
        if (savedData) {
          const parsedData = JSON.parse(savedData);
          setStartDate(new Date(parsedData.startDate));
          setEndDate(new Date(parsedData.endDate));
          setTotalAmount(parsedData.totalAmount);
          setCategories(parsedData.categories);
          setRules(parsedData.rules);
          setRemainingPlan(parsedData.remainingPlan);
        }
      }, []);

      // Save data to localStorage whenever it changes
      useEffect(() => {
        const dataToSave = {
          startDate,
          endDate,
          totalAmount,
          categories,
          rules,
          remainingPlan
        };
        localStorage.setItem('budgetPlannerData', JSON.stringify(dataToSave));
      }, [startDate, endDate, totalAmount, categories, rules, remainingPlan]);

      // Handle adding a new category
      const handleAddCategory = () => {
        if (newCategoryName.trim()) {
          const newCategory = {
            id: Date.now(),
            name: newCategoryName.trim(),
            expenses: []
          };
          setCategories([...categories, newCategory]);
          setNewCategoryName('');
        }
      };

      // Handle deleting a category
      const handleDeleteCategory = (id) => {
        setCategories(categories.filter(category => category.id !== id));
      };

      // Handle adding an expense to a category
      const handleAddExpense = (categoryId, expense) => {
        setCategories(categories.map(category => {
          if (category.id === categoryId) {
            return {
              ...category,
              expenses: [...category.expenses, {
                id: Date.now(),
                ...expense
              }]
            };
          }
          return category;
        }));
      };

      // Handle deleting an expense from a category
      const handleDeleteExpense = (categoryId, expenseId) => {
        setCategories(categories.map(category => {
          if (category.id === categoryId) {
            return {
              ...category,
              expenses: category.expenses.filter(expense => expense.id !== expenseId)
            };
          }
          return category;
        }));
      };

      // Handle adding a new rule
      const handleAddRule = () => {
        if (newRule.amount > 0 && newRule.description.trim() && newRule.category.trim()) {
          const ruleToAdd = {
            id: Date.now(),
            ...newRule
          };
          setRules([...rules, ruleToAdd]);
          setNewRule({
            type: 'daily',
            amount: 0,
            description: '',
            category: '',
            day: 0
          });
        }
      };

      // Handle deleting a rule
      const handleDeleteRule = (id) => {
        setRules(rules.filter(rule => rule.id !== id));
      };

      // Generate PDF report
      const generatePDF = () => {
        const input = pdfRef.current;
        html2canvas(input).then(canvas => {
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgProps = pdf.getImageProperties(imgData);
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
          
          pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
          pdf.save('budget-report.pdf');
        });
      };

      // Get category-wise spending data for chart
      const getCategoryData = () => {
        return categories.map(category => {
          const categoryTotal = category.expenses.reduce((sum, expense) => sum + expense.amount, 0);
          return {
            name: category.name,
            amount: categoryTotal
          };
        });
      };
      

      // Get daily spending data for chart
      const getDailyData = () => {
        const dailyData = {};
        const currentDate = new Date(startDate);
        
        // Initialize all days with 0
        while (currentDate <= endDate) {
          const dateStr = currentDate.toISOString().split('T')[0];
          dailyData[dateStr] = 0;
          currentDate.setDate(currentDate.getDate() + 1);
        }
        
        // Add actual expenses
        categories.forEach(category => {
          category.expenses.forEach(expense => {
            if (expense.date) {
              const dateStr = new Date(expense.date).toISOString().split('T')[0];
              dailyData[dateStr] = (dailyData[dateStr] || 0) + expense.amount;
            }
          });
        });
        
        // Add rule expenses
        ruleExpenses.forEach(expense => {
          const dateStr = expense.date.toISOString().split('T')[0];
          dailyData[dateStr] = (dailyData[dateStr] || 0) + expense.amount;
        });
        
        return Object.entries(dailyData).map(([date, amount]) => ({
          date,
          amount
        }));
      };

      // Get suggestions for negative balance
      const getSuggestions = () => {
        const suggestions = [];
        const deficit = projectedRemaining < 0 ? Math.abs(projectedRemaining) : 0;
        
        if (deficit > 0) {
          suggestions.push(`You're projected to overspend by ₹${deficit.toFixed(2)}.`);
          
          // Find highest spending categories
          const categorySpending = getCategoryData().sort((a, b) => b.amount - a.amount);
          if (categorySpending.length > 0) {
            suggestions.push(`Consider reducing spending in ${categorySpending[0].name} which accounts for ₹${categorySpending[0].amount.toFixed(2)}.`);
          }
          
          // Check rules
          const totalRulesAmount = rules.reduce((sum, rule) => sum + rule.amount, 0);
          if (totalRulesAmount > 0) {
            suggestions.push(`Review your recurring rules which total ₹${totalRulesAmount.toFixed(2)}.`);
          }
          
          // Suggest extending duration
          suggestions.push(`Extending your budget duration by ${Math.ceil(deficit / (totalAmount / totalDays))} days could balance your budget.`);
        }
        
        return suggestions;
      };

      // Render category chart
      const renderCategoryChart = () => {
        const data = getCategoryData();
        const ctx = document.getElementById('categoryChart');
        
        if (ctx) {
          new Chart(ctx, {
            type: 'pie',
            data: {
              labels: data.map(item => item.name),
              datasets: [{
                data: data.map(item => item.amount),
                backgroundColor: [
                  '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', 
                  '#FF9F40', '#8AC24A', '#607D8B', '#E91E63', '#9C27B0'
                ]
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'bottom'
                }
              }
            }
          });
        }
      };
      

      // Render daily spending chart
      const renderDailyChart = () => {
        const data = getDailyData();
        const ctx = document.getElementById('dailyChart');
        
        if (ctx) {
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: data.map(item => item.date),
              datasets: [{
                label: 'Daily Spending',
                data: data.map(item => item.amount),
                backgroundColor: '#4BC0C0'
              }]
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  display: false
                },
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }
      };

useEffect(() => {
  let categoryChart = null;
  let dailyChart = null;

  if (activeTab === 'reports') {
    // 1. Category Chart (Pie)
    const categoryCtx = document.getElementById('categoryChartReport');
    if (categoryCtx) {
      // Destroy previous instance if exists
      if (categoryChart) {
        categoryChart.destroy();
      }

      const categoryData = getCategoryData();
      
      categoryChart = new Chart(categoryCtx, {
        type: 'pie',
        data: {
          labels: categoryData.map(item => item.name),
          datasets: [{
            data: categoryData.map(item => item.amount),
            backgroundColor: [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
              '#9966FF', '#FF9F40', '#8AC24A', '#607D8B'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
            },
            tooltip: {
              callbacks: {
                label: (context) => {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: ₹${value.toFixed(2)} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }
const getDailyData = () => {
  const dailyData = {};
  const currentDate = new Date(startDate);
  
  // Initialize all days with 0
  while (currentDate <= endDate) {
    const dateStr = currentDate.toLocaleDateString('en-US', { 
      month: 'short', 
      day: 'numeric' 
    });
    dailyData[dateStr] = 0;
    currentDate.setDate(currentDate.getDate() + 1);
  }
  
  // Add actual expenses
  categories.forEach(category => {
    category.expenses.forEach(expense => {
      if (expense.date) {
        const dateStr = new Date(expense.date).toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric' 
        });
        dailyData[dateStr] = (dailyData[dateStr] || 0) + expense.amount;
      }
    });
  });
  
  // Add rule expenses
  ruleExpenses.forEach(expense => {
    const dateStr = expense.date.toLocaleDateString('en-US', { 
      month: 'short', 
      day: 'numeric' 
    });
    dailyData[dateStr] = (dailyData[dateStr] || 0) + expense.amount;
  });
  
  return Object.entries(dailyData).map(([date, amount]) => ({
    date,
    amount
  }));
};
    // 2. Daily Spending Chart (Bar)
    const dailyCtx = document.getElementById('dailyChartReport');
    if (dailyCtx) {
      // Destroy previous instance if exists
      if (dailyChart) {
        dailyChart.destroy();
      }

      const dailySpendingData = getDailyData();
      
      dailyChart = new Chart(dailyCtx, {
        type: 'bar',
        data: {
          labels: dailySpendingData.map(item => item.date),
          datasets: [{
            label: 'Daily Spending (₹)',
            data: dailySpendingData.map(item => item.amount),
            backgroundColor: '#4F46E5',
            borderColor: '#3730A3',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                label: (context) => `₹${context.raw.toFixed(2)}`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: (value) => `₹${value}`
              }
            },
            x: {
              ticks: {
                autoSkip: true,
                maxRotation: 45,
                minRotation: 45
              }
            }
          }
        }
      });
    }
  }

  // Cleanup function
  return () => {
    if (categoryChart) {
      categoryChart.destroy();
    }
    if (dailyChart) {
      dailyChart.destroy();
    }
  };
}, [activeTab, categories, rules, startDate, endDate]);
      // Initialize charts when component mounts and data changes
      useEffect(() => {
        renderCategoryChart();
        renderDailyChart();
      }, [categories, rules, startDate, endDate]);

      return (
        <div className={`min-h-screen ${darkMode ? 'dark-mode' : 'bg-gray-100'}`}>
          <div className="container mx-auto px-4 py-8">
            <div className="flex justify-between items-center mb-8">
              <h1 className="text-3xl font-bold">Smart Budget Planner</h1>
              <button 
                onClick={() => setDarkMode(!darkMode)}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg"
              >
                {darkMode ? 'Light Mode' : 'Dark Mode'}
              </button>
            </div>
            
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
              <div className="card bg-white p-6 rounded-lg shadow">
                <h2 className="text-xl font-semibold mb-4">Budget Period</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block mb-1">Start Date</label>
                    <input
                      type="date"
                      value={startDate.toISOString().split('T')[0]}
                      onChange={(e) => setStartDate(new Date(e.target.value))}
                      className="w-full p-2 border rounded"
                    />
                  </div>
                  <div>
                    <label className="block mb-1">End Date</label>
                    <input
                      type="date"
                      value={endDate.toISOString().split('T')[0]}
                      onChange={(e) => setEndDate(new Date(e.target.value))}
                      className="w-full p-2 border rounded"
                    />
                  </div>
                  <div>
                    <p>Total Days: {totalDays}</p>
                  </div>
                </div>
              </div>
              
              <div className="card bg-white p-6 rounded-lg shadow">
                <h2 className="text-xl font-semibold mb-4">Budget Amount</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block mb-1">Total Available (₹)</label>
                    <input
                      type="number"
                      value={totalAmount}
                      onChange={(e) => setTotalAmount(parseFloat(e.target.value) || 0)}
                      className="w-full p-2 border rounded"
                    />
                  </div>
                  <div>
                    <p>Spent: ₹{spentAmount.toFixed(2)}</p>
                    <p>Remaining: ₹{remainingAmount.toFixed(2)}</p>
                    <div className="progress-bar mt-2">
                      <div 
                        className="progress-bar-fill" 
                        style={{ width: `${spentPercentage}%` }}
                      ></div>
                    </div>
                    <p className="text-sm mt-1">{spentPercentage.toFixed(1)}% spent</p>
                  </div>
                </div>
              </div>
              
              <div className="card bg-white p-6 rounded-lg shadow">
                <h2 className="text-xl font-semibold mb-4">Projected Spending</h2>
                <div className="space-y-4">
                  <div>
                    <p>Projected Total: ₹{totalProjectedAmount.toFixed(2)}</p>
                    <p>Projected Remaining: ₹{projectedRemaining.toFixed(2)}</p>
                    <div className="progress-bar mt-2">
                      <div 
                        className="progress-bar-fill" 
                        style={{ 
                          width: `${projectedPercentage}%`,
                          backgroundColor: projectedRemaining < 0 ? '#F44336' : '#4CAF50'
                        }}
                      ></div>
                    </div>
                    <p className="text-sm mt-1">{projectedPercentage.toFixed(1)}% projected</p>
                  </div>
                  {projectedRemaining < 0 && (
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                      <p className="font-bold">Warning: Forecast goes negative by ₹{Math.abs(projectedRemaining).toFixed(2)}</p>
                      <ul className="list-disc pl-5 mt-2">
                        {getSuggestions().map((suggestion, index) => (
                          <li key={index}>{suggestion}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
              </div>
            </div>
            
            <div className="flex mb-4 border-b">
              <button
                className={`px-4 py-2 ${activeTab === 'expenses' ? 'border-b-2 border-blue-500 font-semibold' : ''}`}
                onClick={() => setActiveTab('expenses')}
              >
                Expenses
              </button>
              <button
                className={`px-4 py-2 ${activeTab === 'rules' ? 'border-b-2 border-blue-500 font-semibold' : ''}`}
                onClick={() => setActiveTab('rules')}
              >
                Recurring Rules
              </button>
              <button
                className={`px-4 py-2 ${activeTab === 'plan' ? 'border-b-2 border-blue-500 font-semibold' : ''}`}
                onClick={() => setActiveTab('plan')}
              >
                Budget Plan
              </button>
              <button
                className={`px-4 py-2 ${activeTab === 'reports' ? 'border-b-2 border-blue-500 font-semibold' : ''}`}
                onClick={() => setActiveTab('reports')}
              >
                Reports
              </button>
            </div>
            
            {activeTab === 'expenses' && (
              <div className="card bg-white p-6 rounded-lg shadow mb-8">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-semibold">Expense Categories</h2>
                  <div className="flex">
                    <input
                      type="text"
                      value={newCategoryName}
                      onChange={(e) => setNewCategoryName(e.target.value)}
                      placeholder="New category name"
                      className="p-2 border rounded mr-2"
                    />
                    <button
                      onClick={handleAddCategory}
                      className="px-4 py-2 bg-green-600 text-white rounded-lg"
                    >
                      Add Category
                    </button>
                  </div>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {categories.map(category => (
                    <div key={category.id} className="card bg-gray-50 p-4 rounded-lg shadow">
                      <div className="flex justify-between items-center mb-2">
                        <h3 className="font-semibold">{category.name}</h3>
                        <button
                          onClick={() => handleDeleteCategory(category.id)}
                          className="text-red-600 hover:text-red-800"
                        >
                          Delete
                        </button>
                      </div>
                      
                      <ExpenseList
                        expenses={category.expenses}
                        onAddExpense={(expense) => handleAddExpense(category.id, expense)}
                        onDeleteExpense={(expenseId) => handleDeleteExpense(category.id, expenseId)}
                      />
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {activeTab === 'rules' && (
              <div className="card bg-white p-6 rounded-lg shadow mb-8">
                <h2 className="text-xl font-semibold mb-4">Recurring Expense Rules</h2>
                
                <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                  <h3 className="font-semibold mb-2">Add New Rule</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label className="block mb-1">Rule Type</label>
                      <select
                        value={newRule.type}
                        onChange={(e) => setNewRule({...newRule, type: e.target.value})}
                        className="w-full p-2 border rounded"
                      >
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                      </select>
                    </div>
                    {newRule.type === 'weekly' && (
                      <div>
                        <label className="block mb-1">Day of Week</label>
                        <select
                          value={newRule.day}
                          onChange={(e) => setNewRule({...newRule, day: parseInt(e.target.value)})}
                          className="w-full p-2 border rounded"
                        >
                          <option value="0">Sunday</option>
                          <option value="1">Monday</option>
                          <option value="2">Tuesday</option>
                          <option value="3">Wednesday</option>
                          <option value="4">Thursday</option>
                          <option value="5">Friday</option>
                          <option value="6">Saturday</option>
                        </select>
                      </div>
                    )}
                    <div>
                      <label className="block mb-1">Amount (₹)</label>
                      <input
                        type="number"
                        value={newRule.amount}
                        onChange={(e) => setNewRule({...newRule, amount: parseFloat(e.target.value) || 0})}
                        className="w-full p-2 border rounded"
                      />
                    </div>
                    <div>
                      <label className="block mb-1">Category</label>
                      <input
                        type="text"
                        value={newRule.category}
                        onChange={(e) => setNewRule({...newRule, category: e.target.value})}
                        className="w-full p-2 border rounded"
                        placeholder="Category name"
                      />
                    </div>
                  </div>
                  <div className="mb-4">
                    <label className="block mb-1">Description</label>
                    <input
                      type="text"
                      value={newRule.description}
                      onChange={(e) => setNewRule({...newRule, description: e.target.value})}
                      className="w-full p-2 border rounded"
                      placeholder="Description"
                    />
                  </div>
                  <button
                    onClick={handleAddRule}
                    className="px-4 py-2 bg-green-600 text-white rounded-lg"
                  >
                    Add Rule
                  </button>
                </div>
                
                <div className="space-y-4">
                  {rules.map(rule => (
                    <div key={rule.id} className="p-4 border rounded-lg">
                      <div className="flex justify-between">
                        <div>
                          <h4 className="font-semibold">
                            {rule.type === 'daily' ? 'Daily' : `${['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][rule.day]} Weekly`}: 
                            ₹{rule.amount} - {rule.description}
                          </h4>
                          <p className="text-sm">Category: {rule.category}</p>
                        </div>
                        <button
                          onClick={() => handleDeleteRule(rule.id)}
                          className="text-red-600 hover:text-red-800"
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {activeTab === 'plan' && (
              <div className="card bg-white p-6 rounded-lg shadow mb-8">
                <h2 className="text-xl font-semibold mb-4">Budget Planning</h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <div className="p-4 bg-gray-50 rounded-lg">
                    <h3 className="font-semibold mb-2">Remaining Budget Planner</h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block mb-1">I want to use the remaining ₹</label>
                        <input
                          type="number"
                          value={remainingPlan.amount}
                          onChange={(e) => setRemainingPlan({
                            ...remainingPlan,
                            amount: parseFloat(e.target.value) || 0
                          })}
                          className="w-full p-2 border rounded"
                        />
                      </div>
                      <div>
                        <label className="block mb-1">for the next ___ days</label>
                        <input
                          type="number"
                          value={remainingPlan.days}
                          onChange={(e) => setRemainingPlan({
                            ...remainingPlan,
                            days: parseInt(e.target.value) || 0
                          })}
                          className="w-full p-2 border rounded"
                        />
                      </div>
                    </div>
                  </div>
                  
                  <div className="p-4 bg-gray-50 rounded-lg">
                    <h3 className="font-semibold mb-2">Budget Summary</h3>
                    <div className="space-y-2">
                      <p>Daily Allowance: ₹{dailyAllowance.toFixed(2)}</p>
                      <p>Weekly Allowance: ₹{weeklyAllowance.toFixed(2)}</p>
                      <p>Total Projected: ₹{totalProjectedAmount.toFixed(2)}</p>
                      <p>Projected Remaining: ₹{projectedRemaining.toFixed(2)}</p>
                    </div>
                  </div>
                </div>
                
                <div className="mb-6">
                  <h3 className="font-semibold mb-2">Daily Budget Breakdown</h3>
                  <div className="overflow-x-auto">
                    <table className="min-w-full bg-white">
                      <thead>
                        <tr>
                          <th className="py-2 px-4 border">Date</th>
                          <th className="py-2 px-4 border">Planned</th>
                          <th className="py-2 px-4 border">Actual</th>
                          <th className="py-2 px-4 border">Difference</th>
                        </tr>
                      </thead>
                      <tbody>
                        {Array.from({ length: totalDays }).map((_, index) => {
                          const currentDate = new Date(startDate);
                          currentDate.setDate(currentDate.getDate() + index);
                          const dateStr = currentDate.toISOString().split('T')[0];
                          
                          // Calculate planned amount (daily allowance + any rules for this day)
                          let plannedAmount = dailyAllowance;
                          rules.forEach(rule => {
                            if (rule.type === 'daily') {
                              plannedAmount += rule.amount;
                            } else if (rule.type === 'weekly' && currentDate.getDay() === rule.day) {
                              plannedAmount += rule.amount;
                            }
                          });
                          
                          // Calculate actual expenses for this day
                          const actualAmount = categories.reduce((total, category) => {
                            return total + category.expenses.reduce((sum, expense) => {
                              if (expense.date && new Date(expense.date).toISOString().split('T')[0] === dateStr) {
                                return sum + expense.amount;
                              }
                              return sum;
                            }, 0);
                          }, 0);
                          
                          const difference = plannedAmount - actualAmount;
                          
                          return (
                            <tr key={index}>
                              <td className="py-2 px-4 border">{dateStr}</td>
                              <td className="py-2 px-4 border">₹{plannedAmount.toFixed(2)}</td>
                              <td className="py-2 px-4 border">₹{actualAmount.toFixed(2)}</td>
                              <td className={`py-2 px-4 border ${difference < 0 ? 'text-red-600' : 'text-green-600'}`}>
                                ₹{difference.toFixed(2)}
                              </td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            )}
            
            {activeTab === 'reports' && (
              <div className="card bg-white p-6 rounded-lg shadow mb-8">
                <div ref={pdfRef} className="p-6">
                  <h2 className="text-2xl font-bold mb-4 text-center">Budget Report</h2>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                      <h3 className="text-xl font-semibold mb-2">Summary</h3>
                      <div className="space-y-2">
                        <p>Budget Period: {startDate.toISOString().split('T')[0]} to {endDate.toISOString().split('T')[0]}</p>
                        <p>Total Days: {totalDays}</p>
                        <p>Total Budget: ₹{totalAmount.toFixed(2)}</p>
                        <p>Amount Spent: ₹{spentAmount.toFixed(2)}</p>
                        <p>Amount Remaining: ₹{remainingAmount.toFixed(2)}</p>
                        <p>Projected Total: ₹{totalProjectedAmount.toFixed(2)}</p>
                        <p>Projected Remaining: ₹{projectedRemaining.toFixed(2)}</p>
                      </div>
                    </div>
                    
                    <div>
                      <h3 className="text-xl font-semibold mb-2">Category Breakdown</h3>
                      <canvas id="categoryChartReport" width="400" height="400"></canvas>
                    </div>
                  </div>
                  
                  <div className="mb-6">
                    <h3 className="text-xl font-semibold mb-2">Daily Spending</h3>
                    <canvas id="dailyChartReport" width="800" height="400"></canvas>
                  </div>
                  
                  <div className="mb-6">
                    <h3 className="text-xl font-semibold mb-2">Recurring Rules</h3>
                    <ul className="list-disc pl-5">
                      {rules.map(rule => (
                        <li key={rule.id}>
                          {rule.type === 'daily' ? 'Daily' : `${['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][rule.day]} Weekly`}: 
                          ₹{rule.amount} - {rule.description} (Category: {rule.category})
                        </li>
                      ))}
                    </ul>
                  </div>
                  
                  {projectedRemaining < 0 && (
                    <div className="mb-6 p-4 bg-red-100 rounded-lg">
                      <h3 className="text-xl font-semibold mb-2 text-red-800">Budget Warning</h3>
                      <p className="font-bold text-red-800">You're projected to overspend by ₹{Math.abs(projectedRemaining).toFixed(2)}</p>
                      <h4 className="font-semibold mt-2 text-red-800">Suggestions:</h4>
                      <ul className="list-disc pl-5">
                        {getSuggestions().map((suggestion, index) => (
                          <li key={index} className="text-red-800">{suggestion}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
                
                <div className="flex justify-center">
                  <button
                    onClick={generatePDF}
                    className="px-6 py-3 bg-blue-600 text-white rounded-lg no-print"
                  >
                    Download PDF Report
                  </button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    function ExpenseList({ expenses, onAddExpense, onDeleteExpense }) {
      const [newExpense, setNewExpense] = useState({
        description: '',
        amount: 0,
        date: new Date().toISOString().split('T')[0],
        notes: ''
      });
      
      const handleAddExpense = () => {
        if (newExpense.description.trim() && newExpense.amount > 0) {
          onAddExpense({
            ...newExpense,
            amount: parseFloat(newExpense.amount)
          });
          setNewExpense({
            description: '',
            amount: 0,
            date: new Date().toISOString().split('T')[0],
            notes: ''
          });
        }
      };
      
      return (
        <div>
          <div className="space-y-2 mb-4">
            <input
              type="text"
              value={newExpense.description}
              onChange={(e) => setNewExpense({...newExpense, description: e.target.value})}
              placeholder="Description"
              className="w-full p-2 border rounded"
            />
            <div className="grid grid-cols-2 gap-2">
              <input
                type="number"
                value={newExpense.amount}
                onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})}
                placeholder="Amount"
                className="p-2 border rounded"
              />
              <input
                type="date"
                value={newExpense.date}
                onChange={(e) => setNewExpense({...newExpense, date: e.target.value})}
                className="p-2 border rounded"
              />
            </div>
            <input
              type="text"
              value={newExpense.notes}
              onChange={(e) => setNewExpense({...newExpense, notes: e.target.value})}
              placeholder="Notes (optional)"
              className="w-full p-2 border rounded"
            />
            <button
              onClick={handleAddExpense}
              className="w-full px-4 py-2 bg-blue-600 text-white rounded-lg"
            >
              Add Expense
            </button>
          </div>
          
          <div className="scrollable-table">
            <table className="min-w-full">
              <thead>
                <tr>
                  <th className="py-1 px-2 border-b text-left">Date</th>
                  <th className="py-1 px-2 border-b text-left">Description</th>
                  <th className="py-1 px-2 border-b text-left">Amount</th>
                  <th className="py-1 px-2 border-b text-left">Actions</th>
                </tr>
              </thead>
              <tbody>
                {expenses.map(expense => (
                  <tr key={expense.id}>
                    <td className="py-1 px-2 border-b">{expense.date}</td>
                    <td className="py-1 px-2 border-b">
                      <div>
                        <p>{expense.description}</p>
                        {expense.notes && <p className="text-xs text-gray-500">{expense.notes}</p>}
                      </div>
                    </td>
                    <td className="py-1 px-2 border-b">₹{expense.amount.toFixed(2)}</td>
                    <td className="py-1 px-2 border-b">
                      <button
                        onClick={() => onDeleteExpense(expense.id)}
                        className="text-red-600 hover:text-red-800"
                      >
                        Delete
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>